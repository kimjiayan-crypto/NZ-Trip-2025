<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç´è¥¿è˜­è‡ªé§•æˆ°æƒ…å®¤ - 15å¤©å…¨æ”»ç•¥</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --primary: #1a2a3a; --accent: #e67e22; --danger: #c0392b; --safe: #27ae60; --info: #3498db; }
        body { margin: 0; font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; display: flex; flex-direction: column; height: 100vh; background: #f0f2f5; }
        header { background: var(--primary); color: white; padding: 12px; text-align: center; z-index: 1001; }
        
        #container { display: flex; flex: 1; overflow: hidden; }
        
        /* å´é‚Šæ¬„å‡ç´š */
        #sidebar { width: 450px; overflow-y: auto; background: #fff; border-right: 1px solid #ddd; z-index: 1000; scroll-behavior: smooth; }
        .summary-card { background: var(--primary); color: white; padding: 20px; margin: 10px; border-radius: 12px; font-size: 0.9rem; }
        .filter-bar { padding: 10px; background: #fff; border-bottom: 1px solid #eee; position: sticky; top: 0; z-index: 10; display: flex; gap: 5px; }
        .filter-btn { padding: 5px 10px; border-radius: 20px; border: 1px solid #ddd; cursor: pointer; font-size: 0.8rem; background: white; }
        .filter-btn.active { background: var(--accent); color: white; border-color: var(--accent); }

        /* æ¯æ—¥å¡ç‰‡çµæ§‹åŒ– */
        .day-box { padding: 20px; border-bottom: 8px solid #f0f2f5; transition: 0.3s; }
        .active-day { background: #fff9f5; border-left: 8px solid var(--accent); }
        .section-title { font-weight: bold; font-size: 0.85rem; color: #7f8c8d; margin-top: 12px; margin-bottom: 4px; border-left: 3px solid #ddd; padding-left: 8px; }
        .highlight-text { color: var(--accent); font-weight: bold; font-size: 1.1rem; }
        
        .time-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .time-item { background: #f8f9fa; padding: 8px; border-radius: 6px; font-size: 0.8rem; }
        
        .todo-item { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; margin-top: 4px; }
        .todo-item input { cursor: pointer; }

        .footer-banner { background: #fff3cd; color: #856404; padding: 10px; font-size: 0.85rem; text-align: center; border-top: 1px solid #ffeeba; }

        #map { flex: 1; }
        @media (max-width: 768px) { #container { flex-direction: column-reverse; } #sidebar { width: 100%; height: 45%; } }
    </style>
</head>
<body>

<header>ğŸ‡³ğŸ‡¿ ç´è¥¿è˜­è‡ªé§•æˆ°æƒ…å®¤ (15å¤©è¡Œç¨‹æ‰‹å†Š)</header>

<div id="container">
    <div id="sidebar">
        <div class="summary-card">
            <h3 style="margin-top:0;">ğŸ“ æ—…ç¨‹ç¸½è¦½ (CHC ç’°ç‹€)</h3>
            <p>è·¯ç·šï¼šCHC â†’ æ¹–å€ â†’ åº«å…‹å±± â†’ æ±å²¸ â†’ ç“¦ç´å¡ â†’ çš‡åé® â†’ å³½ç£ â†’ å›ç¨‹</p>
            <div style="display:flex; gap:10px;">
                <span>å¼·åº¦ï¼šâ­â­ (ä¸­ç­‰)</span>
                <span>ğŸ”¥ é—œéµæ—¥ï¼šD3, D4, D13</span>
            </div>
            <p style="font-size:0.8rem; opacity:0.8; margin-top:10px;">â€» å»ºè­°ï¼šD3/D13 éœ€æ—©èµ·ï¼ŒD8/D14 å¯ç¡æ™šã€‚</p>
        </div>

        <div class="filter-bar">
            <button class="filter-btn active" onclick="filterType('all')">å…¨éƒ¨</button>
            <button class="filter-btn" onclick="filterType('warn')">âš ï¸ è­¦ç¤º</button>
            <button class="filter-btn" onclick="filterType('food')">ğŸ´ ç¾é£Ÿ</button>
            <button class="filter-btn" onclick="filterType('gear')">ğŸ§¥ è£å‚™</button>
        </div>

        <div id="itinerary-list"></div>
    </div>
    <div id="map"></div>
</div>

<div class="footer-banner">
    ğŸš¨ å®‰å…¨æé†’ï¼šå¤©é»‘ä¸é–‹å±±è·¯ | æ¯ 2 å°æ™‚ä¼‘æ¯ | æ²¹é‡åŠæ¡¶å°±è£œ | ç ‚è …é é˜² (é¢¨è¡£+é•·è¤²)
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // å°ˆå®¶å¾®èª¿å¾Œçš„å®Œæ•´è³‡æ–™çµæ§‹
    const itinerary = [
        { 
            day: 1, title: "å•Ÿç¨‹ç´è¥¿è˜­", highlight: "è·¨è¶Šæ™‚å·®çš„ç¬¬ä¸€æ­¥", 
            startTime: "18:30 TPE å‡ºç™¼", driveTime: "é£›èˆª", totalTime: "12hr+", 
            stay: "æ©Ÿä¸Š / å¥§å…‹è˜­è½‰æ©Ÿ", booking: "æ©Ÿç¥¨ (å¿…)", planB: "æ©Ÿå ´ä¼‘æ¯å€å¾…å‘½",
            todo: ["ç¢ºèªé›»å­ç°½è­‰ NZeTA", "é›¢ç·šåœ°åœ–ä¸‹è¼‰", "è­·ç…§æª¢æŸ¥"],
            details: "18:30 TPE èµ·é£›ï¼Œæº–å‚™è¿æ¥ç´”æ·¨åœ‹åº¦ã€‚", pos: [-37.008, 174.791], type: "gear" 
        },
        { 
            day: 2, title: "åŸºç£åŸå–è»Š", highlight: "ç†Ÿæ‚‰å·¦é§•èˆ‡è¶…å¸‚è£œçµ¦", 
            startTime: "13:30 å–è»Šå®Œç•¢", driveTime: "20m", totalTime: "1hr", 
            stay: "åŸºç£åŸå¸‚å€ (The Grange)", booking: "ç§Ÿè»Š/é£¯åº— (å¿…)", food: "Riverside Market",
            todo: ["Pak'nSave å¤§æ¡è²·(æ°´/é›¶é£Ÿ)", "è¾¦ç†ç•¶åœ° SIM å¡", "ç†Ÿæ‚‰å·¦é§•æ‰“æª”"],
            details: "å–è»Šå¾Œå…ˆå»è¶…å¸‚ï¼Œå‚æ™šé›…èŠ³æ²³æ•£æ­¥æ¶ˆè§£ç–²å‹ã€‚", pos: [-43.532, 172.636], type: "food" 
        },
        { 
            day: 3, title: "å‰å¾€ Tekapo", highlight: "ä¸–ç•Œæ˜Ÿç©ºä¿è­·å€èˆ‡é®­é­šæ´¾", 
            startTime: "09:00 æœ€æ™šå‡ºç™¼", driveTime: "3hr", totalTime: "5hr (å«åœé )", 
            stay: "Tekapo (Peppers)", booking: "è§€æ˜Ÿåœ˜ (å»º)", food: "Fairlie Bakehouse é®­é­šæ´¾",
            todo: ["Geraldine åœç•™ä¼‘æ¯", "æ‹å–„ç‰§æ•™å ‚", "åŠå¤œè§€æ˜Ÿé å‚™"],
            details: "è·¯ç¶“ Fairlie å¿…è²·é®­é­šæ´¾ã€‚Tekapo è§€æ˜Ÿè¦çœ‹æ°£è±¡ã€‚", pos: [-44.004, 170.477], type: "food" 
        },
        { 
            day: 4, title: "åº«å…‹å±±å¥è¡Œ", highlight: "Hooker Valley å†°æ²³å†°å±±", 
            startTime: "09:30 å‡ºç™¼", driveTime: "1.2hr", totalTime: "3hr (å«æ‹ç…§)", 
            stay: "åº«å…‹å±± (The Hermitage)", booking: "é£¯åº— (å¿…)", gear: "ç™»å±±é‹/é˜²é¢¨è¡£",
            todo: ["Peter's Lookout æ‹æ¹–", "å¸¶ç“¶è£æ°´å¥è¡Œ", "å……é£½ç›¸æ©Ÿé›»æ± "],
            details: "Hooker Valley æ­¥é“ä¾†å›ç´„ 3.5hrï¼Œå»ºè­°è¶Šæ—©é–‹å§‹è¶Šå¥½ã€‚", pos: [-43.734, 170.096], type: "gear" 
        },
        { 
            day: 5, title: "æ±å²¸çœ‹ä¼éµ", highlight: "å¤§åœ“çŸ³èˆ‡è—ä¼éµæ­¸å·¢", 
            startTime: "09:30 æœ€æ™šå‡ºç™¼", driveTime: "2.7hr", totalTime: "5hr", 
            stay: "Oamaru", booking: "ä¼éµç¥¨ (å»º)", warn: "ä¼éµå€ç¦é–ƒå…‰ç‡ˆ",
            planB: "è‹¥ä¸‹å¤§é›¨ï¼Œä¼éµæ­¸å·¢å¯èƒ½å–æ¶ˆï¼Œæ”¹å¸‚å€å®¤å…§é¤é¤¨",
            todo: ["æŸ¥æ½®æ±çœ‹å¤§åœ“çŸ³", "ææ—©45åˆ†åˆ°ä¼éµå ´", "ç©¿æ¥µæš–è¡£ç‰©(æµ·é‚Šå†·)"],
            details: "å¤§åœ“çŸ³éœ€åœ¨é€€æ½®æ™‚æœ€ç¾ã€‚æ™šä¸Šä¼éµæ­¸å·¢éå¸¸å†·ï¼Œå‹™å¿…ç©¿ç¾½çµ¨ã€‚", pos: [-45.097, 170.970], type: "warn" 
        },
        { 
            day: 6, title: "ç©¿è¶Š Lindis Pass", highlight: "å…§é™¸é«˜å±±çµ•æ™¯èˆ‡é®­é­š", 
            startTime: "09:00 å‡ºç™¼", driveTime: "3.2hr", totalTime: "5.5hr", 
            stay: "Wanaka (Edgewater)", food: "High Country Salmon", warn: "å±±è·¯å¤šå½æ³¨æ„æšˆè»Š",
            todo: ["Omarama ä¼‘æ¯åƒé®­é­š", "Lindis Pass è§€æ™¯å°åœé ", "æ‹ Wanaka Tree å¤•é™½"],
            details: "Lindis Pass æ˜¯ç¶“å…¸å…¬è·¯ï¼Œè·¯å½è«‹å¾Œåº§åƒæšˆè»Šè—¥ã€‚", pos: [-44.694, 169.132], type: "warn" 
        },
        { 
            day: 13, title: "ç±³ä½›å³½ç£ (æœ€ç¡¬æ—¥)", highlight: "ä¸–ç•Œç¬¬å…«å¤§å¥‡è¹ŸéŠèˆ¹", 
            startTime: "06:30 å¿…é ˆé›¢é–‹é£¯åº—", driveTime: "4.5hr (ä¾†å›)", totalTime: "12hr", 
            stay: "Te Anau", booking: "èˆ¹ç¥¨ (å¿…é è¨‚)", warn: "ç„¡è¨Šè™Ÿ / ç ‚è …æ¥µå¤š", gear: "é›¨è¡£ / é›¢ç·šåœ°åœ–",
            planB: "ä¸‹é›¨ç…§å»æ›´ç¾(ç€‘å¸ƒå¤š)ï¼›è‹¥å°è·¯æ”¹ Te Anau æ•£æ­¥",
            todo: ["å¸¶å¥½åˆé¤é¤ç›’", "æª¢æŸ¥æ²¹é‡(å³½ç£ç„¡æ²¹ç«™)", "ç©¿é˜²æ°´å¤–å¥—"],
            details: "ç´è¥¿è˜­è‡ªé§•æœ€å±éšªä¹Ÿæœ€ç¾çš„å…¬è·¯ã€‚å‹™å¿…éµå®ˆæ™‚é–“ã€‚", pos: [-44.671, 167.926], type: "warn" 
        }
    ];

    // åˆå§‹åŒ–åœ°åœ–èˆ‡é›™å‘é€£å‹•
    const map = L.map('map').setView([-44.2, 170.5], 7);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png').addTo(map);

    const sidebar = document.getElementById('itinerary-list');
    const markers = {};

    itinerary.forEach((item) => {
        const customIcon = L.divIcon({
            className: 'custom-div-icon',
            html: `<div class='marker-pin'></div><div class='marker-text'>${item.day}</div>`,
            iconSize: [32, 42], iconAnchor: [16, 42]
        });

        const marker = L.marker(item.pos, { icon: customIcon }).addTo(map)
            .bindPopup(`<b>D${item.day}: ${item.title}</b><br>â±ï¸ç¸½æ™‚é•·: ${item.totalTime}`);
        
        markers[item.day] = marker;

        // 7B) é» marker åŒæ­¥é«˜äº®å´æ¬„
        marker.on('click', () => {
            scrollToDay(item.day);
        });

        const card = document.createElement('div');
        card.className = `day-box filter-${item.type}`;
        card.id = `day-card-${item.day}`;
        card.innerHTML = `
            <div class="highlight-text">Day ${item.day}: ${item.highlight}</div>
            <div style="font-weight:bold; color:#34495e;">ğŸ“ ${item.title}</div>
            
            <div class="time-grid">
                <div class="time-item">ğŸ•™ å‡ºç™¼ï¼š${item.startTime}</div>
                <div class="time-item">ğŸ  ä½å®¿ï¼š${item.stay}</div>
                <div class="time-item">ğŸš— ç´”è¡Œè»Šï¼š${item.driveTime}</div>
                <div class="time-item">â³ å«åœé ï¼š${item.totalTime}</div>
            </div>

            <div class="section-title">ä»Šæ—¥å¿…åš (Todo)</div>
            ${item.todo.map(t => `<div class="todo-item"><input type="checkbox"> ${t}</div>`).join('')}

            <div class="section-title">å°ˆå®¶å»ºè­°èˆ‡å‚™æ¡ˆ</div>
            <div style="font-size:0.85rem; line-height:1.5;">
                ${item.warn ? `<span style="color:var(--danger)">âš ï¸è­¦å‘Š: ${item.warn}</span><br>` : ''}
                ${item.planB ? `<span style="color:var(--info)">ğŸ”„å‚™æ¡ˆ: ${item.planB}</span><br>` : ''}
                ğŸ“– è©³æƒ…: ${item.details}
            </div>
        `;

        card.onclick = () => {
            map.flyTo(item.pos, 10);
            marker.openPopup();
            setActiveCard(item.day);
        };
        sidebar.appendChild(card);
    });

    function scrollToDay(day) {
        const card = document.getElementById(`day-card-${day}`);
        card.scrollIntoView({ behavior: 'smooth', block: 'center' });
        setActiveCard(day);
    }

    function setActiveCard(day) {
        document.querySelectorAll('.day-box').forEach(b => b.classList.remove('active-day'));
        document.getElementById(`day-card-${day}`).classList.add('active-day');
    }

    function filterType(type) {
        document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        
        document.querySelectorAll('.day-box').forEach(card => {
            if(type === 'all' || card.classList.contains(`filter-${type}`)) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    }

    L.polyline(itinerary.map(i => i.pos), { color: '#e67e22', weight: 2, opacity: 0.5, dashArray: '5, 10' }).addTo(map);
    window.dispatchEvent(new Event('resize'));
</script>
</body>
</html>
